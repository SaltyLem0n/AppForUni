@{
    ViewData["Title"] = "ค้นหาผู้ได้รับรางวัล";
    string popupTitle = (string)(ViewBag.PopupTitle ?? "");
    string popupMsg = (string)(ViewBag.PopupMessage ?? "");
    string popupType = (string)(ViewBag.PopupType ?? "");
}

<!-- Link the external CSS -->
<link rel="stylesheet" href="~/css/search.css" />

<!-- Background Layers -->
<div class="page-background-wrapper">
    <div class="radial-grid"></div>
    <div class="mesh-blob blob-1"></div>
    <div class="mesh-blob blob-2"></div>
</div>

<div class="search-container">
    <div class="search-card">

        <h2 class="search-title">ค้นหาผู้ได้รับรางวัล</h2>

        <form asp-action="Search" method="post">
            @Html.AntiForgeryToken()

            <div class="input-group-custom">
                <label class="input-label" for="empSearch">EmployeeID</label>
                <input id="empSearch" type="text" name="employeeId"
                       class="search-input"
                       placeholder="กรอก/สแกน EmployeeID แล้วกด Enter"
                       autofocus autocomplete="off" />
            </div>

            <button type="submit" class="btn-search-submit">
                ค้นหา
            </button>
        </form>

        <div class="divider"></div>

        <a asp-action="Select" class="btn-back-outline">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;"><path d="M19 12H5" /><path d="M12 19l-7-7 7-7" /></svg>
            กลับหน้าเลือกรางวัล
        </a>
    </div>
</div>

<!-- Modern Custom Modal -->
<div id="modalBackdrop" class="modal-backdrop">
    <div class="modal-dialog-centered">

        <!-- Header: Changes color based on type -->
        <div id="modalHeader" class="modal-header-custom">
            <!-- Icons for states -->
            <div id="iconSuccess" style="display:none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></svg>
            </div>
            <div id="iconError" style="display:none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><line x1="15" y1="9" x2="9" y2="15" /><line x1="9" y1="9" x2="15" y2="15" /></svg>
            </div>
            <div id="iconInfo" style="display:none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></svg>
            </div>

            <span id="modalTitleText" class="modal-title-custom">Title</span>
        </div>

        <div class="modal-body-custom">
            <span id="modalBodyText"></span>
        </div>

        <div class="modal-footer-custom">
            <button type="button" class="btn-modal-close" onclick="closeModal()">Close</button>
        </div>
    </div>
</div>

<script>
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalHeader = document.getElementById('modalHeader');
    const modalTitleText = document.getElementById('modalTitleText');
    const modalBodyText = document.getElementById('modalBodyText');
    const empInput = document.getElementById('empSearch');

    // Icons
    const iconSuccess = document.getElementById('iconSuccess');
    const iconError = document.getElementById('iconError');
    const iconInfo = document.getElementById('iconInfo');

    function openModal(title, msg, type) {
        // Set Content
        modalTitleText.textContent = title;
        modalBodyText.textContent = msg || "";

        // Reset Styles
        modalHeader.classList.remove('status-success', 'status-error', 'status-info');
        iconSuccess.style.display = 'none';
        iconError.style.display = 'none';
        iconInfo.style.display = 'none';

        // Apply Logic
        if (type === "success") {
            modalHeader.classList.add('status-success');
            iconSuccess.style.display = 'block';
        } else if (type === "error") {
            modalHeader.classList.add('status-error');
            iconError.style.display = 'block';
        } else {
            modalHeader.classList.add('status-info');
            iconInfo.style.display = 'block';
        }

        // Show Modal
        modalBackdrop.style.display = "block";
    }

    function closeModal() {
        modalBackdrop.style.display = "none";
        if(empInput) empInput.focus();
    }

    // Auto-open logic if server sent data
    const serverTitle = "@popupTitle";
    const serverMsg = "@popupMsg";
    const serverType = "@popupType";

    if (serverTitle) {
        openModal(serverTitle, serverMsg, serverType);
    }
</script>